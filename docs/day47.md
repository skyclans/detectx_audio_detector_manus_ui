# Day 47: FP 대응 파이프라인 설계 및 UX 개선

## Test Overview

**Date:** 2026-01-25

**Objective:** Human FP 발생 시 사용자 친화적인 검증 플로우 설계 및 AI 제작자 자동 필터링 메커니즘 구축

## 배경

### 문제점
- CNN + DIFF 시스템에서 Human 곡이 AI로 오판되는 FP 발생
- 작곡가 입장에서 억울한 상황 발생 가능
- 수동 검증은 요청량 증가 시 대응 불가

### Day 45 Demucs DIFF 4/7 성능 (참고)
| 지표 | 결과 |
|------|------|
| 전체 정확도 | 91.2% |
| Human→Human (FP 보호) | 93.8% |
| AI→AI (탐지율) | 87.8% |

## 최종 파이프라인 설계

### 플로우 다이어그램

```
[1차] 서버 기존 시스템 (CNN + DIFF)
              ↓
         AI 판정?
         ↓ No → ✅ Human 확정
         ↓ Yes
┌──────────────────────────────────────────┐
│ ⚠️ AI 유사 특성 감지                       │
│                                          │
│ 과도한 리버브, 강한 마스터링, EDM 장르 등   │
│ 에서 드물게 이런 결과가 나올 수 있습니다.   │
│                                          │
│ 💡 드라이 믹스/스템으로 재업로드 시          │
│    더 정확한 판정이 가능합니다.             │
│                                          │
│ 🔒 파일은 검증 후 즉시 폐기 (서버 미보관)    │
│                                          │
│ [ 드라이 믹스 업로드 ]  [ 심층 분석 요청 ]   │
└──────────────────────────────────────────┘
              ↓
[2차] 드라이 믹스 업로드 시 → Demucs DIFF 4/7 자동 분석
              ↓
         여전히 AI?
         ↓ No → ✅ Human 확정
         ↓ Yes
[3차] 심층 분석 요청 → 드라이 믹스/스템 필수 첨부
              ↓
         (수동 검토 대기열)
```

### 단계별 처리 방식

| 단계 | 방식 | 처리 | 비고 |
|------|------|------|------|
| 1차 | CNN + 기존 DIFF | 자동 | 서버 기존 시스템 |
| 2차 | Demucs DIFF 4/7 | 자동 | 드라이 믹스 필요 |
| 3차 | 심층 분석 | 수동 | 스템 필수 첨부 |

## AI 제작자 자동 필터링 메커니즘

### 핵심 원리

AI 음악(Suno, Udio 등)은 다음 파일을 제공할 수 없음:
- 드라이 믹스 (리버브 제거 버전)
- 개별 스템 파일 (보컬, 드럼, 베이스 등)
- DAW 프로젝트 파일

### 결과

```
AI 제작자가 심층 분석 요청
         ↓
"드라이 믹스 또는 스템 파일을 첨부해 주세요"
         ↓
AI 제작자: 파일 없음 😱
         ↓
요청 포기 (자동 필터링)
```

## 안내 메시지 (UI 적용용)

### 1차 AI 판정 시 안내문

```
⚠️ AI 유사 특성 감지

과도한 리버브, 강한 마스터링, EDM 장르 등에서
드물게 이런 결과가 나올 수 있습니다.

💡 드라이 믹스/스템으로 재업로드 시
   더 정확한 판정이 가능합니다.
   (리버브 및 플러그인 제거 후 다시 업로드해 주세요)

🔒 파일은 검증 후 즉시 폐기되며, 서버에 보관하지 않습니다.

[ 드라이 믹스 업로드 ]  [ 심층 분석 요청 ]
```

### 짧은 버전 (UI 공간 제한 시)

```
⚠️ 추가 검증 필요

과도한 리버브, 강한 마스터링, EDM 장르 등에서
드물게 AI와 유사하게 판정될 수 있습니다.

드라이 믹스 또는 스템 파일을 제출해 주세요.
🔒 검증 후 즉시 폐기 (서버 미보관)
```

## Demucs DIFF 4/7 메트릭 (참고)

Day 45에서 도출된 7개 메트릭 (4개 이상 충족 시 AI 판정):

```python
band_bass_diff    < 0.3991  → AI 신호
band_low_mid_diff < 0.2967  → AI 신호
l1_diff           < 0.0029  → AI 신호
snr               >= 30.84  → AI 신호
energy_ratio      >= 0.9690 → AI 신호
phase_coherence   >= 0.7231 → AI 신호
band_high_ratio   >= 0.9471 → AI 신호
```

## 예상 효과

### 수동 작업 최소화
- 1차~2차: 완전 자동화
- 3차(심층 분석)까지 도달하는 케이스: 극소수 (Day 45 기준 4/69 = 5.8%)

### AI 제작자 자동 차단
- 드라이 믹스/스템 제출 불가 → 2차, 3차 단계 진입 불가
- 추가 검증 없이 AI 판정 유지

### Human 작곡가 보호
- 명확한 안내 메시지로 억울함 해소 방안 제공
- 파일 제출 시 자동 재검증으로 빠른 복구 가능

## 구현 참고 파일

- Demucs DIFF 4/7 테스트: `run_demucs_diff_fp_test.py`
- Day 45 결과: `docs/day45.md`
- 메트릭 수집: `run_demucs_detailed_diff.py`
- 기존 DIFF 로직: `server/app/crg_runner.py`

## 결론

이 파이프라인은:
1. **자동화 최대화**: 1차~2차 완전 자동, 수동 개입 최소화
2. **Human 보호**: 명확한 안내 + 드라이 믹스 재검증 옵션
3. **AI 차단**: 파일 제출 요구로 자연스러운 필터링
4. **프라이버시 보장**: 검증 후 즉시 폐기 명시

를 통해 운영 효율성과 사용자 경험을 모두 개선합니다.
